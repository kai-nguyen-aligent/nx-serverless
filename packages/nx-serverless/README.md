# nx-serverless

A collection of Nx generators, executors, and plugins for serverless development, powered by Nx, a powerful tool for monorepo management.

## Usage

The `@aligent/nx-serverless` package provides the following features:

### Generators

#### Preset:

- This generator is a special generator that will generate the whole Nx workspace
- It is used by `@aligent/create-nx-serverless` CLI tool to generate new workspace for serverless development.
- Without the `@aligent/create-nx-serverless` CLI tool, we can generate workspace by running:
  ```bash
    nx generate @aligent/nx-serverless:preset --name my-serverless-workspace
  ```

#### Service:

- This generator is used to generate a serverless service
- To generate a service, run the command:
  ```bash
    # Assuming we are inside the workspace generated by 'preset' generator above
    nx generate service service-name
  ```

### Executors

#### Link

- This executor links services together by leveraging the `implicitDependencies` feature from Nx.
- To link service A to services B and C, runs:
  ```bash
  # This will add serviceB and serviceC to the implicitDependencies list of serviceA
  nx run serviceA:link --to serviceB,serviceC
  ```
- To link service F from service D and E, runs:
  ```bash
  # This will add serviceF to the implicitDependencies list of serviceD and serviceE
  nx run serviceF:link --from serviceD,serviceE
  ```

#### Unlink

<!-- TODO: Under development and will be added in the future -->

### Plugins

- The plugins part of this package utilises [Project Crystal](https://nx.dev/concepts/inferred-tasks#inferred-tasks-project-crystal) from Nx to infer tasks/targets for serverless services.
- This plugin identify our project by looking for `serverless.yml` file. For each project it can find, the following targets are added to the project:
  - `build`: build the project using `serverless package` command.
  - `deploy`: deploy the project using `serverless deploy` command.
  - `remove`: remove the project using `serverless remove` command.
  - `link`: link projects by the link executor mentioned above.
- While most of the targets above can be configured in `project.json`, inferring tasks helps:
  - Reducing manual configuration and improve configuration consistency.
  - Automatically adjusting task dependencies, especially when removing projects. Eg: `remove` task will read the dependencies graph and update itself so that the dependent projects are removed before the main one.
